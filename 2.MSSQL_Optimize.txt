数据库优化

一、多种ec2镜像实例的备份数据库导入实验
1、已OK：镜像Win2012 server R2 base + 自建安装SQL server 2012 Express X64英文版本。
验证数据库备份文件OK后，按照导入方法导入OK。（此方法曾经在Win7+SQL server 2012 Express X86 中文版本验证成功）

2、待验证：镜像win2008 server R2 with SQL server 2008 R2，验证数据库备份完整性，安装导入方法导入。

二、还原备份数据库：在EC2当中进行备份数据库还原。
参照数据库备份还原方法

已解决问题：
###英文版的操作系统要下载英文版的SQL Server 2012 Express相应版本，下中文版，安装会出错。

###还原数据库出错，查找原因，验证备份文件失败，对文件完整性检验。
由于数据库备份文件解压之后文件较大，需要校验MD5进行文件完整性验证。先校验存储在S3上面的压缩备份文件完整性，
再校验解压后的文件MD5.与已恢复成功的数据对比之后发现是先前的解压出了问题。

遗留问题：
###还原数据库成功，解决查询结果中文是乱码问题。


三、优化数据库（使用名字查询时速度加快），参见表优化方法
### 根据前期对此数据的优化经验，少走弯路，优化步骤如下，至于为什么要这么优化，参见《SQL数据库使用》。

1、创建一个新的数据库实例，eg.shenfenzheng。（单个Express数据库实例有10GB空间限制）
2、重现设计一张info表，对数据的长度进行限制。（字段变小方便做聚集索引）

新表列名只要如下几个字段，数据类型全部选择nvarchar[50],除Address选择nvarchar[100]、Email选择nvarchar[60](最长有个55).

SELECT [Name]

      ,[CtfId]

      ,[Gender]

      ,[Birthday]

      ,[Address]

      ,[District3]

      ,[District4]

      ,[Mobile]

      ,[Tel]

      ,[EMail]

      ,[Family]

      ,[Version]

      ,[id]

  FROM [shenfenzheng].[dbo].[cdsgus]

  Where Name='张三'

3、从原shifenzheng数据库中分段执行查询相应表达字段与然后插入到新的实例的info表中。
（考虑执行速度，分段将需要的数据生成新的表）

insert into [shenfenzheng].[dbo].[info] SELECT [Name]

      ,[CtfId]

      ,[Gender]

      ,[Birthday]

      ,[Address]

      ,[District3]

      ,[District4]

      ,[Mobile]

      ,[Tel]

      ,[EMail]

      ,[Family]

      ,[Version]

      ,[id]

  FROM [shifenzheng].[dbo].[cdsgus]

  Where id>15000000

  /* Seperate Four Stage To Make a new table

  -- where id<5000001

  -- Where id>5000000 and id<10000001

  -- Where id>10000000 and id<15000001

  -- Where id>15000000

     */

4、以Name字段为条件建立聚集索引。（以Name查询时，速度OK）



四、将优化后的数据库备份压缩，上传至S3.

五、将备份文件导入到RDS

六、优化RDS

七、MSSQL数据导入到MySQL RDS
http://www.cnblogs.com/xjb/archive/2013/02/01/sqlservertomysql.html


### 要将 SQL Server 数据导入数据库实例,请按照 将数据导入 Amazon RDS 上的 SQL Server 部分 提供的信息操作。
您不能使用备份和还原命令将数据导入数据库实例,因为 Amazon RDS 不允许您具备 可将文件放在数据库引擎可以访问的物理位置的操作系统级访问权限。
此外,您也不能使用 SQL Server Management Studio 中的复制数据库向导导入数据,因为该工具需要源服务器和目标服务器的 sysadmin 权限,而此权限不可用于数据库实例的主用户账户。


